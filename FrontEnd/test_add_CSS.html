<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="project.css" />
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

    <script>

        let seletedDate; // input type= date 의 선택된 value값 저장
        let onlyTextarea;

        const months = [
            "January",
            "February",
            "March",
            "April",
            "May",
            "June",
            "July",
            "August",
            "September",
            "October",
            "November",
            "December"
        ];
        const read_data_school_schedule = (month) => { // html parsing and ajax send
           let monthContainer = document.querySelector(".monthContainer");
           let containercercleNumber = document.querySelector(".container-cercle-number");
           let monthTitle = document.querySelector(".month-title");
            let hoho = document.querySelector("#hoho");


           if (containercercleNumber.firstChild !== null) {
               containercercleNumber.removeChild(containercercleNumber.firstChild);
           }
           if (monthTitle.firstChild !== null) {
               monthTitle.removeChild(monthTitle.firstChild);
           }
           if (hoho.firstChild !== null) {
               hoho.removeChild(hoho.firstChild);
           }

           let doc;

           $.ajax({
               url: 'crawl.php',
               type: 'get',
               dataType: 'json',
               async: false,
               success: function (data) {

                   var parser = new DOMParser();
                   doc = parser.parseFromString(data, 'text/html').querySelector('ul').getElementsByTagName('li');
               },



               error: function(data) {
               }
           });
            const classNameNumMonth = doc[month -1].querySelector(".num em"); // 달 숫자
            const classNameDesc = doc[month -1].querySelector(".desc"); // 학사일정 내용

            containercercleNumber.appendChild(classNameNumMonth);
            monthTitle.innerText = `${months[month - 1]}`; // 월 영문을 month-title에 text로 삽입
            hoho.appendChild(classNameDesc);

           return
       }
        const delete_schedule = () => {
           const selectedDate = document.getElementById("deleteInput").value;
           $.ajax({
               url: 'scheduleDelete.php',
               type: 'POST',
               data: {deleteDate : selectedDate},
               dataType: 'json',
               async:  false,
               success: function (data){
               },
               error: function (e){
                   alert("선택한 날짜에 메모가 존재하지 않습니다")
               }

           });
       }
        const handleDateChange = (date) => {
           let deleteInput = document.querySelector("#deleteInput");
            if ( date !== undefined || date !== null){
                seletedDate = date;
                deleteInput.value = date;
            }
       }
        window.addEventListener('DOMContentLoaded', function () { // dom load at active function show schedule
           const date = new Date();
           read_data_school_schedule(date.getMonth() + 1);
       });

        function read_data_todolist(date){
            if(onlyTextarea === undefined){ onlyTextarea = document.querySelector("#onlyTextarea");}
            let Temp;
            seletedDate = date;
            $.ajax({
                url: 'samplecode.php',
                type: 'get',
                dataType: 'json',
                async:  false,
                success: function (data){
                    Temp = data.memo
                },
                error: function (e){
                }

            })
            onlyTextarea.value = Temp;
           return Temp;
       }


        function displayMemoInTextarea() {
        var dateMemo = read_data_todolist();
        document.getElementById('TextareaId').value = dateMemo;
        }


        function showSchedule() {
    
            var month = selectedMonthElement.textContent;
            var date = document.getElementById("monthSelect").value;
            var schedule = document.getElementById("scheduleInput").value;

            var outputDiv = document.getElementById("output");

            // 테이블 생성
            var table = document.createElement("table");
            table.style.width = "100%";

            // 헤더 추가
            var headerRow = table.insertRow(0);
            var dateHeader = headerRow.insertCell(0);
            dateHeader.innerHTML = "선택한 날짜";
            var scheduleHeader = headerRow.insertCell(1);
            scheduleHeader.innerHTML = "일정 및 메모";

            // 데이터 추가
            var dataRow = table.insertRow(1);
            var dateCell = dataRow.insertCell(0);
            dateCell.innerHTML = month + " " + date + "일";
            var scheduleCell = dataRow.insertCell(1);
            scheduleCell.innerHTML = schedule;

            // 기존 내용 지우고 새로운 테이블 추가
            outputDiv.innerHTML = "";
            outputDiv.appendChild(table);

        }
    </script>
</head>
<body>


    <center><h2> Sungkyul ToDoList</h2></center>
    <label>Student Number</label>
    <input type="number" name="studentNumber" onsubmit="">
    <!-- input 에 js함수 만들어야함
    ajax ->  db -> 학번 vaildate 잇으면 localStorage 저장, 없으면 저장 하시겠습니까 alert() 후 저장 ( 학번에 맞는 table 생성 )

    ! localStorage 에는 1개의 key-value 쌍의 studentNumber 만 존재 해야함

    날짜를 선택하면 localStorage의 key 값과 날짜값을 php 코드에 전송, 테이블을 찾고 날짜를 찾아 반환.
     ( 기존의 table name을 todoList가 아닌 studentNumber로 지정 )

     css 적용
    -->
    <div class="wrap">
        <div class="scroll__wrap">
            <button class="circle" onclick="read_data_school_schedule(1)">1</button>
            <button class="circle" onclick="read_data_school_schedule(2)">2</button>
            <button class="circle" onclick="read_data_school_schedule(3)">3</button>
            <button class="circle" onclick="read_data_school_schedule(4)">4</button>
            <button class="circle" onclick="read_data_school_schedule(5)">5</button>
            <button class="circle" onclick="read_data_school_schedule(6)">6</button>
            <button class="circle" onclick="read_data_school_schedule(7)">7</button>
            <button class="circle" onclick="read_data_school_schedule(8)">8</button>
            <button class="circle" onclick="read_data_school_schedule(9)">9</button>
            <button class="circle" onclick="read_data_school_schedule(10)">10</button>
            <button class="circle" onclick="read_data_school_schedule(11)">11</button>
            <button class="circle" onclick="read_data_school_schedule(12)">12</button>
        </div>
    </div>


    

    <div class="monthContainer">
        <div class="container">
            <div class="container-cercle">
                <div class="container-cercle-number">
                </div>
            </div>
                <div class="month-title"></div>

            <div class="container-left">
                <div id="hoho">
                </div>

                <div id="monthSchedule"></div>

            </div>
        </div>
    </div>

    <br><br>
    <hr style="margin-left: 10px; margin-right: 10px;">
    <br><br>

    <form action="samplecode.php" method="POST">
        <div class="display-flex">
            <input
            type="date"
            onchange="handleDateChange(this.value)"

            name="date" required>
            <button type="button" class="small-button right-align"
                    onclick="read_data_todolist(this.value)">일정 확인</button>
        </div>

        <br>
        
        <center><textarea id="onlyTextarea" name="memo" rows="4" cols="50" placeholder="Memo area" required></textarea></center>
        <br>
        <div class="display-flex">

            <input class="small-button right-align" type="submit" value="메모 저장">
        </div>


    </form>
        <input id="deleteInput"
               class="small-button"
               type="button"
               onclick="delete_schedule()"
               value="2023-11-12" >
    <br><br>

</body>

</html>